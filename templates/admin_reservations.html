{% extends 'base.html' %}
{% block content %}
<div class="dashboard-container">
  <!-- Sidebar (reuse from admin.html) -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>UC - Admin</h2>
      <button class="sidebar-inner-toggle" title="Toggle Sidebar">
        <i class="fa fa-bars"></i>
      </button>
    </div>
    <div class="sidebar-menu">
      <ul>
        <li><a href="{{ url_for('admin_dashboard') }}"><i class="fa fa-dashboard"></i> Admin Dashboard</a></li>
        <li><a href="{{ url_for('admin_current_sit_in') }}"><i class="fa fa-users"></i> Current Sit-In</a></li>
        <li><a href="{{ url_for('admin_sit_in_records') }}"><i class="fa fa-list-alt"></i> View Sit-in Records</a></li>
        <li><a href="{{ url_for('admin_leaderboard') }}"><i class="fa fa-trophy"></i> Leaderboard</a></li>
        <li><a href="{{ url_for('admin_announcements') }}"><i class="fa fa-bullhorn"></i> Announcements</a></li>
        <li><a href="{{ url_for('admin_lab_resources') }}"><i class="fa fa-desktop"></i> Lab Resources</a></li>
        <li><a href="{{ url_for('admin_lab_schedule') }}"><i class="fa fa-calendar"></i> Lab Schedule</a></li>
        <li><a href="{{ url_for('admin_reservations') }}" class="active"><i class="fa fa-calendar-check-o"></i> Reservations</a></li>
        <li><a href="{{ url_for('admin_reports') }}"><i class="fa fa-file-text"></i> Generate Reports</a></li>
        <li><a href="{{ url_for('admin_feedback') }}"><i class="fa fa-comments"></i> View Feedback</a></li>
        <li style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;"><a href="{{ url_for('admin_system_management') }}"><i class="fa fa-cogs"></i> System</a></li>
      </ul>
    </div>
  </div>
  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <h1>Lab Reservations</h1>
      <a class="Btn" href="{{ url_for('logout') }}">
        <div class="sign"><i class="fa fa-sign-out" aria-hidden="true"></i></div>
        <div class="text">Logout</div>
      </a>
    </div>
    <!-- Side by side containers -->
    <div class="content-row" style="display: flex; gap: 20px; margin-bottom: 30px;">
      <!-- Left: Computer Control -->
      <div class="schedule-card" style="flex: 1; min-width: 320px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
          <h4 style="margin: 0;"><i class="fa fa-desktop" aria-hidden="true"></i> Computer Control</h4>
          <button id="submitPcStatus" style="background: #2196f3; color: white; border: none; border-radius: 4px; padding: 8px 18px; font-size: 14px; cursor: pointer;">Submit</button>
        </div>
        <div style="margin-bottom: 15px;">
          <label for="labSelect"><strong>Lab:</strong></label>
          <select id="labSelect" class="form-control" style="width: 100%; margin-top: 5px;">
            <option value="" disabled selected>Select a laboratory</option>
            {% for lab in labs %}
            <option value="{{ lab.lab_id }}" data-capacity="{{ lab.capacity }}">
              {{ lab.building }} - Room {{ lab.room_number }} ({{ lab.capacity }} PCs)
            </option>
            {% endfor %}
          </select>
        </div>
        <div id="pcListContainer">
          <div style="color: #888; text-align: center; padding: 30px 0;">
            <em>Select a lab to view PCs...</em>
          </div>
        </div>
        <div id="pcControlButtons" style="display: none; margin-top: 15px; text-align: center;">
          <button id="setAllAvailable" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 8px 18px; margin-right: 10px; font-size: 14px; cursor: pointer;">Available</button>
          <button id="setAllUsed" style="background: #f44336; color: white; border: none; border-radius: 4px; padding: 8px 18px; font-size: 14px; cursor: pointer;">Used</button>
        </div>
      </div>
      <!-- Computer Control JS -->
      {% block scripts %}
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const labSelect = document.getElementById('labSelect');
          const pcListContainer = document.getElementById('pcListContainer');
          const pcControlButtons = document.getElementById('pcControlButtons');
          const setAllAvailable = document.getElementById('setAllAvailable');
          const setAllUsed = document.getElementById('setAllUsed');
          const submitPcStatus = document.getElementById('submitPcStatus');
          let currentCapacity = 0;

          function renderPCs(capacity) {
            let html = '<div id="pcGrid" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">';
            for (let i = 1; i <= capacity; i++) {
              html += `<div class="pc-box available" data-pc="${i}" style="border: 2px solid #43a047; border-radius: 6px; padding: 10px 8px; min-width: 90px; text-align: center; background: rgba(67,160,71,0.7); color: #fff; margin-bottom: 8px; cursor: pointer; transition: background 0.2s; font-weight: bold; box-shadow: 0 2px 8px rgba(67,160,71,0.08);">
                <div style="font-weight: bold; margin-bottom: 6px; color: #fff;">PC ${i}</div>
              </div>`;
            }
            html += '</div>';
            pcListContainer.innerHTML = html;
            pcControlButtons.style.display = '';
          }

          labSelect.addEventListener('change', function() {
            const selectedOption = labSelect.options[labSelect.selectedIndex];
            const capacity = parseInt(selectedOption.getAttribute('data-capacity'));
            currentCapacity = capacity;
            if (!capacity) {
              pcListContainer.innerHTML = '<div style="color: #888; text-align: center; padding: 30px 0;"><em>Select a lab to view PCs...</em></div>';
              pcControlButtons.style.display = 'none';
              return;
            }
            renderPCs(capacity);
          });

          // Toggle individual PC status
          pcListContainer.addEventListener('click', function(e) {
            const box = e.target.closest('.pc-box');
            if (box) {
              if (box.classList.contains('available')) {
                box.classList.remove('available');
                box.classList.add('used');
                box.style.background = 'rgba(229,57,53,0.7)';
                box.style.borderColor = '#e53935';
                box.style.color = '#fff';
              } else {
                box.classList.remove('used');
                box.classList.add('available');
                box.style.background = 'rgba(67,160,71,0.7)';
                box.style.borderColor = '#43a047';
                box.style.color = '#fff';
              }
            }
          });

          // Set all to available
          setAllAvailable.addEventListener('click', function() {
            const boxes = pcListContainer.querySelectorAll('.pc-box');
            boxes.forEach(box => {
              box.classList.remove('used');
              box.classList.add('available');
              box.style.background = 'rgba(67,160,71,0.7)';
              box.style.borderColor = '#43a047';
              box.style.color = '#fff';
            });
          });

          // Set all to used
          setAllUsed.addEventListener('click', function() {
            const boxes = pcListContainer.querySelectorAll('.pc-box');
            boxes.forEach(box => {
              box.classList.remove('available');
              box.classList.add('used');
              box.style.background = 'rgba(229,57,53,0.7)';
              box.style.borderColor = '#e53935';
              box.style.color = '#fff';
            });
          });

          // Submit PC status
          submitPcStatus.addEventListener('click', function() {
            const selectedLab = labSelect.value;
            if (!selectedLab) {
              alert('Please select a laboratory first.');
              return;
            }
            const boxes = pcListContainer.querySelectorAll('.pc-box');
            const pcStatus = Array.from(boxes).map((box, idx) => ({
              pc: idx + 1,
              status: box.classList.contains('available') ? 'Available' : 'Used'
            }));
            // TODO: Send pcStatus and selectedLab to backend via AJAX/fetch
            alert('PC status for Lab ' + selectedLab + ' would be submitted!\n' + JSON.stringify(pcStatus, null, 2));
          });
        });
      </script>
      {% endblock %}
      <!-- Right: Reservation Requests -->
      <div class="schedule-card" style="flex: 2; min-width: 400px;">
        <h4><i class="fa fa-calendar-check-o" aria-hidden="true"></i> Reservation Requests</h4>
        {% if reservations %}
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">ID Number</th>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">Reservation Date</th>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">Reservation Time</th>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">Laboratory</th>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">Computer Number</th>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">Purpose</th>
              <th style="padding: 8px; border-bottom: 1px solid #ddd">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for r in reservations %}
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">{{ r.student_id }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">{{ r.reservation_date }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">{{ r.start_time }} - {{ r.end_time }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">{{ r.building }} - Room {{ r.room_number }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">{{ r.computer_number if r.computer_number else '-' }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">{{ r.purpose }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">
                <button class="approve-btn" style="background: #43a047; color: #fff; border: none; border-radius: 4px; padding: 5px 12px; margin-right: 5px; cursor: pointer;">Approve</button>
                <button class="deny-btn" style="background: #e53935; color: #fff; border: none; border-radius: 4px; padding: 5px 12px; cursor: pointer;">Deny</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No reservations found.</p>
        {% endif %}
      </div>
    </div>
    <!-- Logs container below -->
    <div class="content-row" style="margin-top: 20px;">
      <div class="schedule-card" style="width: 100%;">
        <h4><i class="fa fa-history" aria-hidden="true"></i> Logs</h4>
        <div style="color: #888; text-align: center; padding: 30px 0;">
          <em>Logs will be displayed here...</em>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 